<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ponyo Scrapbook</title>
  <style>
    /* Reset & base */
    * {
      box-sizing: border-box;
    }
    body, html {
      margin: 0; padding: 0; height: 100vh; overflow: hidden;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(to bottom, #90cdf4, #2a4365);
      color: #fff;
      user-select: none;
    }
    #app {
      height: 100vh;
      width: 100vw;
      position: relative;
      overflow: hidden;
    }
    .page {
      position: absolute;
      top: 0; left: 0; width: 100%; height: 100%;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      background: linear-gradient(to bottom, #90cdf4, #2a4365);
      text-align: center;
      transition: opacity 0.6s ease;
    }
    .page.active {
      display: flex;
      opacity: 1;
      z-index: 10;
    }
    .page.hidden {
      opacity: 0;
      z-index: 1;
    }

    /* Cover page */
    #cover input {
      padding: 10px 15px;
      font-size: 1.2rem;
      border-radius: 8px;
      border: none;
      text-align: center;
      width: 140px;
      margin-bottom: 15px;
    }
    #cover button {
      padding: 10px 20px;
      font-size: 1.2rem;
      border-radius: 20px;
      border: none;
      background: #ecc94b;
      color: #2d3748;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    #cover button:hover {
      background: #d69e2e;
    }
    #cover .hint {
      margin-top: 15px;
      font-size: 0.9rem;
      font-style: italic;
      color: #f6e05e;
      user-select: text;
    }
    #cover .error {
      color: #fc8181;
      font-weight: 600;
      margin-top: 8px;
    }

    /* Photo page */
    #photo h2 {
      font-size: 2.8rem;
      font-weight: 700;
      margin-bottom: 20px;
      text-shadow: 2px 2px 4px #1a202c99;
    }
    #photo p {
      max-width: 600px;
      font-size: 1.3rem;
      line-height: 1.5;
      margin-bottom: 40px;
      text-shadow: 1px 1px 3px #1a202caa;
    }
    #photo button {
      padding: 12px 30px;
      font-size: 1.2rem;
      border-radius: 30px;
      border: none;
      background: #ecc94b;
      color: #2d3748;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 4px 6px rgba(0,0,0,0.2);
      transition: background 0.3s ease;
    }
    #photo button:hover {
      background: #d69e2e;
    }

    /* Form page */
    #form input, #form textarea {
      width: 280px;
      max-width: 90vw;
      margin-bottom: 15px;
      border-radius: 12px;
      border: none;
      padding: 12px 15px;
      font-size: 1.1rem;
      font-weight: 600;
      color: #2d3748;
      resize: none;
    }
    #form textarea {
      height: 120px;
    }
    #form button {
      margin-top: 15px;
      padding: 12px 30px;
      font-size: 1.2rem;
      border-radius: 30px;
      border: none;
      background: #ecc94b;
      color: #2d3748;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    #form button:hover {
      background: #d69e2e;
    }
    #form .error {
      color: #fc8181;
      font-weight: 700;
      margin-bottom: 10px;
    }

    /* Message page */
    #messages {
      width: 100%;
      max-width: 700px;
      max-height: 80vh;
      overflow-y: auto;
      padding: 0 10px;
    }
    .msg-card {
      background: #fefcbf;
      color: #2d3748;
      border-radius: 20px;
      padding: 15px 20px;
      margin-bottom: 15px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.15);
      text-align: left;
      cursor: default;
      user-select: text;
    }
    .msg-card strong {
      font-weight: 700;
    }
    .msg-card iframe {
      margin-top: 10px;
      border-radius: 12px;
      width: 100%;
      height: 200px;
      border: none;
    }

    /* Bubble animation */
    .bubble {
      position: absolute;
      border-radius: 50%;
      background: rgba(255 255 255 / 0.3);
      animation-name: rise;
      animation-timing-function: linear;
      animation-iteration-count: infinite;
      pointer-events: none;
      filter: drop-shadow(0 0 2px rgba(255 255 255 / 0.7));
    }
    @keyframes rise {
      0% {
        transform: translateY(0) scale(1);
        opacity: 0.3;
      }
      100% {
        transform: translateY(-110vh) scale(1.2);
        opacity: 0;
      }
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- Cover Page -->
    <section id="cover" class="page active">
      <h1 style="font-size:3rem; font-weight:800; margin-bottom:20px; user-select:text;">Ponyo Scrapbook</h1>
      <input id="passcode-input" type="password" placeholder="Enter Passcode" autocomplete="off" />
      <button id="unlock-btn">Unlock</button>
      <div class="error" id="pass-error"></div>
      <div class="hint">Hint: bulan bulan pusingnya agit</div>
    </section>

    <!-- Photo Page -->
    <section id="photo" class="page">
      <h2>Dear Sahabatku,</h2>
      <p>
        Like the waves that endlessly kiss the shore, our friendship flows with endless warmth and joy. 
        Just like Ponyo’s adventurous spirit, may we always find wonder in every moment we share.
      </p>
      <button id="photo-next-btn">Next</button>
    </section>

    <!-- Form Page -->
    <section id="form" class="page">
      <h2>Send a Message</h2>
      <div class="error" id="form-error"></div>
      <input id="to-input" type="text" placeholder="To (your friend’s name)" />
      <textarea id="message-input" placeholder="Message"></textarea>
      <input id="from-input" type="text" placeholder="From (your name)" />
      <input id="song-input" type="url" placeholder="Song Link (YouTube, optional)" />
      <button id="form-next-btn">Next</button>
    </section>

    <!-- Messages Page -->
    <section id="messages" class="page">
      <h2>Messages For You</h2>
      <div id="messages-list"></div>
    </section>
  </div>

  <!-- Background bubbles container -->
  <div id="bubbles-container"></div>

  <!-- Audio Player -->
  <iframe id="audio-player" width="0" height="0" src="https://www.youtube.com/embed/p7f72y9a5pE?autoplay=1&loop=1&playlist=p7f72y9a5pE&mute=1" frameborder="0" allow="autoplay" allowfullscreen></iframe>

  <script>
    // State
    let currentPageIndex = 0;
    const pages = ['cover', 'photo', 'form', 'messages'];

    // Elements
    const passInput = document.getElementById('passcode-input');
    const unlockBtn = document.getElementById('unlock-btn');
    const passError = document.getElementById('pass-error');

    const photoNextBtn = document.getElementById('photo-next-btn');

    const formNextBtn = document.getElementById('form-next-btn');
    const formError = document.getElementById('form-error');
    const toInput = document.getElementById('to-input');
    const messageInput = document.getElementById('message-input');
    const fromInput = document.getElementById('from-input');
    const songInput = document.getElementById('song-input');

    const messagesList = document.getElementById('messages-list');

    // Passcode unlock
    unlockBtn.addEventListener('click', () => {
      const code = passInput.value.trim();
      if (code === '06') {
        passError.textContent = '';
        goToPage(1);
      } else {
        passError.textContent = 'Wrong passcode, try again!';
      }
    });

    // Photo next
    photoNextBtn.addEventListener('click', () => {
      goToPage(2);
    });

    // Form next with validation
    formNextBtn.addEventListener('click', () => {
      if (!toInput.value.trim() || !messageInput.value.trim() || !fromInput.value.trim()) {
        formError.textContent = 'Please fill all required fields (To, Message, From).';
        return;
      }
      formError.textContent = '';

      // Save message locally (or you can expand with backend later)
      const msgData = {
        to: toInput.value.trim(),
        message: messageInput.value.trim(),
        from: fromInput.value.trim(),
        song: songInput.value.trim()
      };
      saveMessage(msgData);
      clearForm();
      goToPage(3);
      renderMessages();
    });

    // Change page function
    function goToPage(index) {
      currentPageIndex = index;
      pages.forEach((id, i) => {
        const el = document.getElementById(id);
        if (i === index) {
          el.classList.add('active');
          el.classList.remove('hidden');
        } else {
          el.classList.remove('active');
          el.classList.add('hidden');
        }
      });
    }

    // Save messages in localStorage
    function saveMessage(msg) {
      const existing = JSON.parse(localStorage.getItem('ponyo_messages') || '[]');
      existing.push(msg);
      localStorage.setItem('ponyo_messages', JSON.stringify(existing));
    }
    // Render messages
    function renderMessages() {
      const msgs = JSON.parse(localStorage.getItem('ponyo_messages') || '[]');
      if (msgs.length === 0) {
        messagesList.innerHTML = '<p>No messages yet. Send one!</p>';
        return;
      }
      messagesList.innerHTML = '';
      msgs.forEach(({to, message, from, song}, i) => {
        const card = document.createElement('div');
        card.className = 'msg-card';
        card.innerHTML = `
          <strong>To: ${escapeHtml(to)}</strong><br/>
          <p>${escapeHtml(message)}</p>
          <em>From: ${escapeHtml(from)}</em>
          ${song ? `<iframe src="${getEmbedUrl(song)}" allow="autoplay" allowfullscreen></iframe>` : ''}
        `;
        messagesList.appendChild(card);
      });
    }

    // Clear form inputs
    function clearForm() {
      toInput.value = '';
      messageInput.value = '';
      fromInput.value = '';
      songInput.value = '';
    }

    // Escape HTML to avoid injection
    function escapeHtml(text) {
      return text.replace(/[&<>"']/g, function(m) {
        return ({
          '&': '&amp;',
          '<': '&lt;',
          '>': '&gt;',
          '"': '&quot;',
          "'": '&#39;'
        })[m];
      });
    }

    // Convert YouTube URL to embed URL
    function getEmbedUrl(url) {
      try {
        const videoId = url.split('v=')[1]?.split('&')[0];
        if (videoId) return `https://www.youtube.com/embed/${videoId}?autoplay=1&loop=1&playlist=${videoId}`;
      } catch {
        return '';
      }
      return '';
    }

    // Bubble animation
    const bubblesContainer = document.getElementById('bubbles-container');
    function createBubble() {
      const bubble = document.createElement('div');
      bubble.classList.add('bubble');
      const size = Math.random() * 25 + 10;
      bubble.style.width = size + 'px';
      bubble.style.height = size + 'px';
      bubble.style.left = Math.random() * window.innerWidth + 'px';
      bubble.style.bottom = '-30px';
      bubble.style.animationDuration = (Math.random() * 8 + 6) + 's';
      bubblesContainer.appendChild(bubble);

      setTimeout(() => {
        bubble.remove();
      }, 14000);
    }
    setInterval(createBubble, 700);

    // Init
    renderMessages();

  </script>
</body>
</html>
